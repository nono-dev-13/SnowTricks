{% extends 'base.html.twig' %}

{% block title %}Liste des figures{% endblock %}

{% block body %}
<div id="myCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
	<div class="carousel-indicators">
		<button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active" aria-current="true"
			aria-label="Slide 1"></button>
		<button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
		<button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
	</div>
	<div class="carousel-inner">
		<div class="carousel-item active">
			<img src="{{ asset('build/images/img_top.jpeg') }}" class="w-100" />
		</div>
		<div class="carousel-item">
			<img src="{{ asset('build/images/img_top-2.jpeg') }}" class="w-100" />
		</div>
		<div class="carousel-item">
			<img src="{{ asset('build/images/img_top-3.jpeg') }}" class="w-100" />
		</div>
	</div>
	<button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
		<span class="visually-hidden">Précédent</span>
	</button>
	<button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
		<span class="carousel-control-next-icon" aria-hidden="true"></span>
		<span class="visually-hidden">Suivant</span>
	</button>
</div>
<div class="container">
	<div class="row" id="articleList">
		{% for article in listArticles %}
		<div class="col-12 col-md-3 mb-3" id="{{article.id}}">
			<div class="card">
				<img src="..." class="card-img-top" alt="...">
				<div class="card-body">
					<a href="{{ path('article_show', {id: article.id}) }}" class="card-title h5">{{article.name}}</a>
					<div class="action">
						<a href="#">
							<i class="fas fa-pencil-alt"></i>
						</a>
						<a href="#">
							<i class="fas fa-trash-alt"></i>
						</a>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
	<div class="row">
		<div class="col-12">
			<button type="button" id="loadMoreArticles" class="btn btn-primary">Voir plus de Tricks</button>
		</div>
	</div>
</div>

{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function () {
		let loadMoreClick = document.querySelector("#loadMoreArticles");
		let click = 0;
		loadMoreClick.addEventListener('click', function (e) {
			e.preventDefault;
			click++;
			let add = 4 * click;

			const url = "{{ path('load_more_articles') }}" + '/' + add;

			axios.get(url).then(function (response) {
				var data = response.data;
				console.log(data.articlesTotal)
				console.log(data.articlesTotal - add - 4)

				const articleList = document.getElementById('articleList');
				articleList.insertAdjacentHTML('beforeend', data.html);

				if (data.articlesTotal - add - 4 == 0) {
					loadMoreClick.classList.add('none');
				}
			}).catch(function (error) {
				if (error.response.status === 403) {
					window.alert("Vous n'êtes pas autorisé à effectuer cette action !")
				} else if (error.response.status === 403) {
					window.alert("Cette page n'existe pas");
				} else {
					window.alert("Une erreur est survenue !");
				}
			})

		});
	});
</script>

{% endblock %}